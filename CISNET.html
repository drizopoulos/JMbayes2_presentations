<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>JMbayes2</title>
    <meta charset="utf-8" />
    <meta name="author" content="Dimitris Rizopoulos" />
    <meta name="date" content="2021-06-04" />
    <script src="libs/header-attrs-2.8/header-attrs.js"></script>
    <link href="libs/tile-view-0.2.4/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view-0.2.4/tile-view.js"></script>
    <script src="libs/xaringanExtra_fit-screen-0.2.4/fit-screen.js"></script>
    <link rel="stylesheet" href="style.css" type="text/css" />
    <link rel="stylesheet" href="https:/cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">

class: title-slide-custom
count: false



&lt;!-- &lt;h1&gt;JMbayes2&lt;/h1&gt; --&gt;
&lt;div style="font-size: 50pt; font-weight: 900; color: var(--nord4); margin-top: 60px;"&gt;
JMbayes2
&lt;/div&gt;

&lt;div style="font-size: 26pt; color: var(--nord9); font-weight: 300; margin-top:40px;"&gt;
Extended Joint Models under the Bayesian Approach
&lt;/div&gt;

&lt;div id = "author"&gt;
&lt;div style = "font-size: 32pt; font-weight: bolder; color: var(--nord4);"&gt;Dimitris Rizopoulos&lt;/div&gt;
&lt;div style = "color: var(--nord9);"&gt;Department of Biostatistics&lt;/div&gt;
&lt;/div&gt;

&lt;div id="contact"&gt;
&lt;a href="mailto:d.rizopoulos@erasmusmc.nl"&gt;&lt;i class="fas fa-envelope"&gt;&lt;/i&gt; d.rizopoulos@erasmusmc.nl&lt;/a&gt; &amp;emsp;
&lt;a href="https://twitter.com/drizopoulos"&gt;&lt;i class="fab fa-twitter"&gt;&lt;/i&gt; drizopoulos&lt;/a&gt; &amp;emsp;
&lt;a href="https://github.com/drizopoulos"&gt;&lt;i class="fab fa-github"&gt;&lt;/i&gt; drizopoulos&lt;/a&gt; &amp;emsp;
&lt;/div&gt;

---
layout: true

&lt;link href="https://unpkg.com/nord-highlightjs@0.1.0/dist/nord.css" rel="stylesheet" type="text/css" /&gt;
&lt;link href="fontawesome-free-5.14.0-web/css/all.css" rel="stylesheet"&gt;

&lt;div class="my-footer"&gt;&lt;span&gt;
&lt;a href="https://twitter.com/drizopoulos"&gt;&lt;i class="fab fa-twitter"&gt;&lt;/i&gt; drizopoulos&lt;/a&gt;
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
&lt;a href="https://github.com/drizopoulos"&gt;&lt;i class="fab fa-github"&gt;&lt;/i&gt; drizopoulos&lt;/a&gt; &amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
&lt;a href = "http://www.drizopoulos.com/"&gt;&lt;i class="fas fa-globe-americas"&gt;&lt;/i&gt; www.drizopoulos.com&lt;/a&gt;
&lt;/span&gt;&lt;/div&gt; 

---
class: center, middle, animated, fadeIn

# Joint Models:&lt;br&gt;Current Standard

---

## A Bit of History

&lt;p&gt; &lt;/p&gt;

--

&lt;div style = "width: 75%; padding: 1.15em 2em; background-color: var(--nord0); margin: auto; display: block;"&gt;
&lt;strong&gt;Joint models have been around for many years...&lt;/strong&gt;
&lt;/div&gt;

--

&lt;br&gt;

- Two parallel trajectories

.pull-left[
**Event Process**
&lt;div style = "width: 75%; padding: 1.15em 2em; background-color: var(--nord0); margin: auto; display: block;"&gt;
endogenous time-varying covariates
&lt;/div&gt;
]

.pull-right[
**Longitudinal Outcomes**
&lt;div style = "width: 75%; padding: 1.15em 2em; background-color: var(--nord0); margin: auto; display: block;"&gt;
non-random (MNAR) dropout
&lt;/div&gt;
]


---

## JMs and Extensions

&lt;div style = "width: 75%; padding: 1.15em 2em; background-color: var(--nord0); margin: auto; display: block;"&gt;
&lt;strong&gt;Basic assumption: &lt;font color = "red"&gt;Conditional Independence&lt;/font&gt;&lt;/strong&gt; &lt;br&gt; The random effects \(\color{var(--nord15)}{b}\) explain all interrelationships.
&lt;/div&gt;

.footnote[
[&lt;i class = "fas fa-book"&gt;&lt;/i&gt; Rizopoulos (2012)](https://www.crcpress.com/product/isbn/9781439872864)
]

--

&lt;br&gt;
* `\(\mathcal{Y}\)`: Longitudinal process
* `\(\mathcal{T}\)`: Event process

--

`\begin{align*}
p\{\mathcal{Y},\, \mathcal{T} \mid \color{var(--nord15)}{b}\} = 
p\{\mathcal{Y} \mid \color{var(--nord15)}{b}\} \; 
p\{\mathcal{T} \mid \color{var(--nord15)}{b}\}
\end{align*}`

---

## JMs and Extensions



&lt;img src="JM.gif" alt="DynPreds" style="margin:0px 0px 0px 0px; width:450px;"&gt; 

---

## JMs and Extensions

&lt;br&gt;

.pull-left[
**Longitudinal Process**
- multiple outcomes
- continuous, discrete, left-censored
- flexible models (splines, etc.)
]

.pull-right[
**Event Process**
- competing risks
- multi-state processes
- recurrent events
- multivariate
]

---

## JMs and Extensions

**Conditional Independence:** .reference[[&lt;i class = "fas fa-book"&gt;&lt;/i&gt; Rizopoulos (2012)](https://www.crcpress.com/product/isbn/9781439872864)]

&lt;ul class="fa-ul"&gt;
  &lt;li&gt;&lt;span class="fa-li" style = "color:var(--nord14);"&gt;
      &lt;i class="far fa-smile"&gt;&lt;/i&gt;&lt;/span&gt;
      mathematically convenient&lt;/li&gt;
  &lt;li&gt;&lt;span class="fa-li" style = "color:var(--nord11);"&gt;
  &lt;i class="far fa-frown"&gt;&lt;/i&gt;&lt;/span&gt;
  computionally intensive&lt;/li&gt;
&lt;/ul&gt;

--

.pull-left[
**Maximum Likelihood:**
&lt;div style = "width: 75%; padding: 1.15em 2em; background-color: var(--nord0); margin: auto; display: block;"&gt;
requires high-dimensional numerical integration
&lt;/div&gt;
]

.pull-right[
**Bayesian:**
&lt;div style = "width: 75%; padding: 1.15em 2em; background-color: var(--nord0); margin: auto; display: block;"&gt;
requires sampling high-dimensional random effects
&lt;/div&gt;
]

---

## Theory vs Practice

As with many other statistical techniques,&lt;br&gt; 
&amp;nbsp;&amp;nbsp;&amp;nbsp;it took some years for JMs software to appear

--

&lt;br&gt;

&lt;div style = "width: 75%; padding: 1.15em 2em; background-color: var(--nord0); margin: auto; display: block;"&gt;
&lt;strong&gt;Nowadays, given the rise of the  &lt;font color = "red"&gt;R ecosystem&lt;/font&gt; a number of packages is available&lt;/strong&gt;
&lt;/div&gt;


---

## Available Software

.pull-left[
**Maximum Likelihood:**

&lt;button class="modal-button" href="#JM"&gt;&lt;strong&gt;JM&lt;/strong&gt;&lt;/button&gt;
&lt;div id="JM" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
  &lt;ul&gt;
    &lt;li&gt; One continuous longitudinal outcome&lt;/li&gt;
    &lt;li&gt; Competing risks&lt;/li&gt;
    &lt;li&gt; (pseudo) adaptive Gaussian quadrature&lt;/li&gt;
  &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;button class="modal-button" href="#joineRML"&gt;&lt;strong&gt;joineRML&lt;/strong&gt;&lt;/button&gt;
&lt;div id="joineRML" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
  &lt;ul&gt;
    &lt;li&gt; Multiple continuous longitudinal outcomes&lt;/li&gt;
    &lt;li&gt; Monte Carlo EM (&lt;font color="red"&gt;needs tuning&lt;/font&gt;)&lt;/li&gt;
  &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;button class="modal-button" href="#frailtyPack"&gt;&lt;strong&gt;frailtyPack&lt;/strong&gt;&lt;/button&gt;
&lt;div id="frailtyPack" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
  &lt;ul&gt;
    &lt;li&gt; One continuous longitudinal outcome&lt;/li&gt;
    &lt;li&gt; recurrent events &amp; terminating event&lt;/li&gt;
  &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;
]

.pull-right[
**Bayesian:**
&lt;button class="modal-button" href="#JMbayes"&gt;&lt;strong&gt;JMbayes&lt;/strong&gt;&lt;/button&gt;
&lt;div id="JMbayes" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
  &lt;ul&gt;
    &lt;li&gt; Multiple longitudinal outcomes of different type&lt;/li&gt;
    &lt;li&gt; competing risks &amp; multi-state models&lt;/li&gt;
    &lt;li&gt; Corrected two-stage approach (&lt;font color="red"&gt;not fully Bayesian&lt;/font&gt;)&lt;/li&gt;
  &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;button class="modal-button" href="#stan_jm"&gt;&lt;strong&gt;stan_jm&lt;/strong&gt;&lt;/button&gt;
&lt;div id="stan_jm" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
  &lt;ul&gt;
    &lt;li&gt; Multiple longitudinal outcomes of different type&lt;/li&gt;
    &lt;li&gt; fully Bayesian in STAN (&lt;font color="red"&gt;slow&lt;/font&gt;)&lt;/li&gt;
  &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;button class="modal-button" href="#bamlss"&gt;&lt;strong&gt;jm_bamlss&lt;/strong&gt;&lt;/button&gt;
&lt;div id="bamlss" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
  &lt;ul&gt;
    &lt;li&gt; single longitudinal outcomes&lt;/li&gt;
    &lt;li&gt; no competing risks nor multi-state models&lt;/li&gt;
  &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;
]

---

## Available Software

&lt;br&gt;&lt;br&gt;

&lt;div style = "width: 75%; padding: 1.15em 2em; background-color: var(--nord0); margin: auto; display: block;"&gt;
&lt;strong&gt;Still no software package exists to satisfy all needs&lt;/strong&gt;
&lt;/div&gt;

---
class: center, middle, animated, fadeIn

# JMbayes2

---

## A New Package

.nord0box[
**&lt;span style="font-size: 1.5rem;"&gt;&amp;#8680;&lt;/span&gt; 
Learning from the lessons of the past we decided to create a new package**
]

--

&lt;br&gt;

Our aims

.pull-left[
* versatile
* user-friendly
* fast
* complete
]

.pull-right[
&lt;div style = "color: var(--nord3);"&gt;
&lt;ul&gt;
&lt;li&gt;cover (almost) all extensions&lt;/li&gt;
&lt;li&gt;straightforward syntax&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;C++&lt;/strong&gt; &amp; computational tricks&lt;/li&gt;
&lt;li&gt;support functions&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
]

---

## Under the Hood

.nord0box[
**Work horse: Metropolis-Hastings algorithm** &lt;br&gt;
&amp;nbsp;&amp;nbsp;&lt;span style="font-size: 1.5rem;"&gt;&amp;#8680;&lt;/span&gt; adaptive optimal scaling using the Robbinsâ€“Monro process
]

--

&lt;br&gt;

.nord0box[
**Computational aspects** &lt;br&gt;
&amp;nbsp;&amp;nbsp;&lt;span style="font-size: 1.5rem;"&gt;&amp;#8680;&lt;/span&gt; parallel sampling of random effects&lt;br&gt;
&amp;nbsp;&amp;nbsp;&lt;span style="font-size: 1.5rem;"&gt;&amp;#8680;&lt;/span&gt; info from separate fits&lt;br&gt;
]

---

## Under the Hood

&lt;br&gt;

.nord0box[
**Implementation** &lt;br&gt;
&amp;nbsp;&amp;nbsp;&lt;span style="font-size: 1.5rem;"&gt;&amp;#8680;&lt;/span&gt; MCMC written in C++&lt;br&gt;
&amp;nbsp;&amp;nbsp;&lt;span style="font-size: 1.5rem;"&gt;&amp;#8680;&lt;/span&gt; avoiding double computations&lt;br&gt;
]



---

## An Example


```r
library("JMbayes2")
fm1 &lt;- lme(log(serBilir) ~ year * sex, data = pbc2, random = ~ year | id)
CoxFit &lt;- coxph(Surv(years, status2) ~ sex, data = pbc2.id)

jointFit1 &lt;- jm(CoxFit, fm1, time_var = "year")
```

--

&lt;br&gt;

**Check convergence**


```r
ggtraceplot(jointFit1, "alphas")
```


---

## Traceplot

&lt;img src="CISNET_files/figure-html/unnamed-chunk-4-1.png" width="100%" /&gt;

---

## Model Summary

.scroll450[

```r
summary(jointFit1)
```

```
## 
## Call:
## jm(Surv_object = CoxFit, Mixed_objects = fm1, time_var = "year")
## 
## Data Descriptives:
## Number of Groups: 312		Number of events: 140 (44.9%)
## Number of Observations:
##   log(serBilir): 1945
## 
##                  DIC     WAIC      LPML
## marginal    4775.360 10956.55 -6547.622
## conditional 4958.314 12267.66 -6720.478
## 
## Random-effects covariance matrix:
##                     
##        StdDev   Corr
## (Intr) 1.0126 (Intr)
## year   0.1793 0.3545
## 
## Survival Outcome:
##                         Mean  StDev    2.5%  97.5%     P   Rhat
## sexfemale            -0.1701 0.4586 -1.0777 0.7692 0.682 1.0031
## value(log(serBilir))  1.2011 0.1225  0.9706 1.4538 0.000 1.0284
## 
## Longitudinal Outcome: log(serBilir) (family = gaussian, link = identity)
##                   Mean  StDev    2.5%  97.5%      P   Rhat
## (Intercept)     0.7265 0.3130  0.1108 1.3334 0.0218 1.0037
## year            0.2608 0.1013  0.0660 0.4639 0.0133 1.0071
## sexfemale      -0.2629 0.3273 -0.8927 0.3757 0.4133 1.0026
## year:sexfemale -0.0899 0.1051 -0.2994 0.1147 0.3773 1.0056
## sigma           0.4050 0.0230  0.3694 0.4609 0.0000 1.0332
## 
## MCMC summary:
## chains: 3 
## iterations per chain: 3500 
## burn-in per chain: 500 
## thinning: 1 
## time: 13 sec
```
]

---

## Multivariate

&lt;br&gt;


```r
fm2 &lt;- lme(prothrombin ~ year * sex, data = pbc2, random = ~ year | id)
fm3 &lt;- mixed_model(ascites ~ year + sex, data = pbc2,
                   random = ~ year | id, family = binomial())

jointFit2 &lt;- jm(CoxFit, list(fm1, fm2, fm3), time_var = "year",
                n_iter = 12000L, n_burnin = 2000L, n_thin = 5L)
```

---

## Multivariate

.scroll450[

```r
summary(jointFit2)
```

```
## 
## Call:
## jm(Surv_object = CoxFit, Mixed_objects = list(fm1, fm2, fm3), 
##     time_var = "year", n_iter = 12000L, n_burnin = 2000L, n_thin = 5L)
## 
## Data Descriptives:
## Number of Groups: 312		Number of events: 140 (44.9%)
## Number of Observations:
##   log(serBilir): 1945
##   prothrombin: 1945
##   ascites: 1885
## 
##                  DIC      WAIC      LPML
## marginal    12573.41 103828.36 -49559.54
## conditional 14586.81  18634.77 -11187.42
## 
## Random-effects covariance matrix:
##                                                  
##        StdDev   Corr                             
## (Intr) 0.9953 (Intr)   year (Intr)   year (Intr) 
## year   0.1874 0.4001                             
## (Intr) 0.8151 0.5344 0.4577                      
## year   0.3281 0.3989 0.3462 0.0172               
## (Intr) 3.7299 0.5197 0.4882 0.5403 0.2713        
## year   0.6269 0.4026 0.6184 0.2730 0.3977 -0.0340
## 
## Survival Outcome:
##                         Mean  StDev    2.5%  97.5%      P   Rhat
## sexfemale            -0.7478 0.5775 -1.9125 0.3554 0.1830 1.0055
## value(log(serBilir))  0.5997 0.2100  0.1789 1.0099 0.0130 1.0395
## value(prothrombin)    0.0985 0.1168 -0.1440 0.3079 0.3897 1.0642
## value(ascites)        0.4204 0.1231  0.2193 0.7024 0.0000 1.2060
## 
## Longitudinal Outcome: log(serBilir) (family = gaussian, link = identity)
##                   Mean  StDev    2.5%  97.5%      P   Rhat
## (Intercept)     0.6949 0.2831  0.1374 1.2358 0.0153 0.9997
## year            0.2628 0.0785  0.1098 0.4197 0.0013 1.0010
## sexfemale      -0.2309 0.2974 -0.8213 0.3601 0.4273 0.9997
## year:sexfemale -0.0754 0.0808 -0.2374 0.0835 0.3463 1.0016
## sigma           0.3924 0.0186  0.3627 0.4358 0.0000 1.0051
## 
## Longitudinal Outcome: prothrombin (family = gaussian, link = identity)
##                   Mean  StDev    2.5%   97.5%      P   Rhat
## (Intercept)    10.9355 0.4792 10.0039 11.9037 0.0000 1.0001
## year            0.2429 0.1639 -0.0806  0.5714 0.1393 1.0002
## sexfemale      -0.3898 0.5013 -1.3705  0.5869 0.4350 1.0000
## year:sexfemale  0.0527 0.1717 -0.2849  0.3884 0.7543 1.0011
## sigma           1.0857 0.0281  1.0358  1.1466 0.0000 1.0017
## 
## Longitudinal Outcome: ascites (family = binomial, link = logit)
##                Mean  StDev    2.5%   97.5%      P   Rhat
## (Intercept) -5.5081 1.3411 -8.3178 -3.0220 0.0000 1.0121
## year         0.7339 0.2022  0.3645  1.1700 0.0000 1.0367
## sexfemale   -0.3918 1.1504 -2.6540  1.8476 0.7313 1.0011
## 
## MCMC summary:
## chains: 3 
## iterations per chain: 12000 
## burn-in per chain: 2000 
## thinning: 5 
## time: 1.6 min
```
]

---

## Functional Forms


```r
jointFit3 &lt;- update(jointFit2, 
  functional_forms = ~ slope(log(serBilir)) + slope(log(serBilir)):sex + 
    area(prothrombin))
```

--

.pull-left[
**Slope**
`$$h_i(t) = h_0(t) \exp\biggl\{\alpha \bbox[#2E3440, 5pt]{\frac{d\color{var(--nord14)}{\eta(t)}}{dt}}\biggr\}$$`
]

.pull-right[
**(normalized) Area**
`$$h_i(t) = h_0(t) \exp\biggl\{\alpha \bbox[#2E3440, 5pt]{\frac{1}{t} \int_0^t \color{var(--nord14)}{\eta(s)}\; ds}\biggr\}$$`
]

&lt;div align="center" style="padding-top:30px;"&gt;\(\color{var(--nord3)}{\eta(t) = \mathbf x_i(t)^\top \boldsymbol \beta + \mathbf z_i(t)^\top \mathbf b_i}\)&lt;/div&gt;

---

## Functional Forms

.scroll450[

```r
summary(jointFit3)
```

```
## 
## Call:
## jm(Surv_object = CoxFit, Mixed_objects = list(fm1, fm2, fm3), 
##     time_var = "year", functional_forms = ~slope(log(serBilir)) + 
##         slope(log(serBilir)):sex + area(prothrombin), n_iter = 12000L, ...
## 
## Data Descriptives:
## Number of Groups: 312		Number of events: 140 (44.9%)
## Number of Observations:
##   log(serBilir): 1945
##   prothrombin: 1945
##   ascites: 1885
## 
##                       DIC         WAIC          LPML
## marginal     2.404730e+13 2.088299e+29 -3.362423e+16
## conditional -9.162033e+04 1.839327e+04 -1.143109e+04
## 
## Random-effects covariance matrix:
##                                                 
##        StdDev   Corr                            
## (Intr) 0.9805 (Intr)   year (Intr)   year (Intr)
## year   0.1900 0.4630                            
## (Intr) 0.8125 0.5378 0.4825                     
## year   0.3319 0.4231 0.3514 0.0262              
## (Intr) 3.7451 0.5237 0.5019 0.5231 0.2891       
## year   0.6727 0.4770 0.6329 0.3165 0.3905 0.0035
## 
## Survival Outcome:
##                                   Mean  StDev    2.5%  97.5%      P   Rhat
## sexfemale                      -1.2729 0.9790 -3.1052 0.7466 0.2033 1.0516
## slope(log(serBilir))            2.3233 2.3242 -2.5327 6.9599 0.2763 1.0386
## slope(log(serBilir)):sexfemale  1.6171 2.5087 -3.7038 6.1063 0.4887 1.0954
## area(prothrombin)               0.3056 0.2491 -0.2596 0.7340 0.1830 1.0358
## value(ascites)                  0.4899 0.1412  0.2668 0.8231 0.0000 1.0260
## 
## Longitudinal Outcome: log(serBilir) (family = gaussian, link = identity)
##                   Mean  StDev    2.5%  97.5%      P   Rhat
## (Intercept)     0.6945 0.2773  0.1382 1.2288 0.0140 1.0007
## year            0.2647 0.0766  0.1119 0.4162 0.0007 1.0015
## sexfemale      -0.2336 0.2909 -0.8028 0.3478 0.4167 1.0005
## year:sexfemale -0.0686 0.0790 -0.2278 0.0910 0.3670 1.0009
## sigma           0.3924 0.0181  0.3631 0.4339 0.0000 1.0010
## 
## Longitudinal Outcome: prothrombin (family = gaussian, link = identity)
##                   Mean  StDev    2.5%   97.5%      P   Rhat
## (Intercept)    10.9316 0.4883  9.9761 11.8935 0.0000 1.0012
## year            0.2475 0.1652 -0.0805  0.5722 0.1283 1.0009
## sexfemale      -0.3848 0.5168 -1.4130  0.6255 0.4453 1.0004
## year:sexfemale  0.0529 0.1750 -0.2935  0.3954 0.7550 1.0003
## sigma           1.0856 0.0280  1.0375  1.1463 0.0000 1.0009
## 
## Longitudinal Outcome: ascites (family = binomial, link = logit)
##                Mean  StDev    2.5%   97.5%      P   Rhat
## (Intercept) -5.5886 1.3908 -8.4654 -2.9848 0.0000 1.0243
## year         0.7862 0.2112  0.4032  1.2325 0.0000 1.0377
## sexfemale   -0.3766 1.2017 -2.7329  2.0287 0.7453 1.0020
## 
## MCMC summary:
## chains: 3 
## iterations per chain: 12000 
## burn-in per chain: 2000 
## thinning: 5 
## time: 1.7 min
```
]

---

## Competing Risks

Bring the data in the competing risks long format


```r
pbc2.idCR &lt;- crLong(pbc2.id, statusVar = "status", censLevel = "alive", 
                    nameStrata = "CR")

pbc2.idCR[pbc2.idCR$id %in% c(1, 2, 5), c("id", "years", "status", "status2", "CR")]
```

```
##     id     years       status status2           CR
## 1    1  1.095170         dead       1         dead
## 1.1  1  1.095170         dead       0 transplanted
## 2    2 14.152338        alive       0         dead
## 2.1  2 14.152338        alive       0 transplanted
## 5    5  4.120578 transplanted       0         dead
## 5.1  5  4.120578 transplanted       1 transplanted
```

---

## Competing Risks

&lt;br&gt;

Fit a competing risks Cox model


```r
CoxFit_CR &lt;- coxph(Surv(years, status2) ~ (age + drug) * strata(CR),
                     data = pbc2.idCR)
```

---

## Competing Risks

&lt;br&gt;

Fit the competing risks joint model


```r
jFit_CR &lt;- jm(CoxFit_CR, fm1, time_var = "year", 
              functional_forms = ~ value(log(serBilir)):CR, 
              n_iter = 25000L, n_burnin = 5000L, n_thin = 5L)
```

---

## Competing Risks

.scroll450[

```r
summary(jFit_CR)
```

```
## 
## Call:
## jm(Surv_object = CoxFit_CR, Mixed_objects = fm1, time_var = "year", 
##     functional_forms = ~value(log(serBilir)):CR, n_iter = 25000L, 
##     n_burnin = 5000L, n_thin = 5L)
## 
## Data Descriptives:
## Number of Groups: 312		Number of events: 169 (27.1%)
## Number of Observations:
##   log(serBilir): 1945
## 
##                  DIC     WAIC      LPML
## marginal    6142.126 14378.40 -9971.051
## conditional 4345.681 12441.04 -8088.907
## 
## Random-effects covariance matrix:
##                     
##        StdDev   Corr
## (Intr) 1.0084 (Intr)
## year   0.1811 0.3680
## 
## Survival Outcome:
##                                        Mean  StDev    2.5%   97.5%      P
## age                                 -0.0489 0.0241 -0.1002 -0.0047 0.0280
## drugD-penicil                       -0.3003 0.4297 -1.1486  0.5402 0.4813
## age:strata(CR)dead                   0.1108 0.0232  0.0680  0.1600 0.0000
## drugD-penicil:strata(CR)dead         0.3255 0.4725 -0.6068  1.2330 0.4965
## value(log(serBilir)):CRtransplanted  0.9345 0.2027  0.5559  1.3513 0.0000
## value(log(serBilir)):CRdead          1.2364 0.1252  0.9978  1.4926 0.0000
##                                       Rhat
## age                                 1.1434
## drugD-penicil                       1.0063
## age:strata(CR)dead                  1.2466
## drugD-penicil:strata(CR)dead        1.0050
## value(log(serBilir)):CRtransplanted 1.0294
## value(log(serBilir)):CRdead         1.0021
## 
## Longitudinal Outcome: log(serBilir) (family = gaussian, link = identity)
##                   Mean  StDev    2.5%  97.5%      P   Rhat
## (Intercept)     0.7263 0.3186  0.0993 1.3494 0.0237 0.9999
## year            0.2692 0.1033  0.0659 0.4756 0.0117 1.0000
## sexfemale      -0.2657 0.3341 -0.9178 0.3948 0.4203 0.9998
## year:sexfemale -0.0953 0.1078 -0.3112 0.1169 0.3697 0.9999
## sigma           0.4058 0.0237  0.3689 0.4597 0.0000 0.9999
## 
## MCMC summary:
## chains: 3 
## iterations per chain: 25000 
## burn-in per chain: 5000 
## thinning: 5 
## time: 4.4 min
```
]

---

## More Features

.three-cols[

&lt;button class="modal-button" href="#GLMMs"&gt;&lt;strong&gt;Mixed Effects Models&lt;/strong&gt;&lt;/button&gt;
&lt;div id="GLMMs" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
  &lt;ul&gt;
  &lt;li&gt;Gaussian (&lt;code&gt;lme(...)&lt;/code&gt;)&lt;/li&gt;
    &lt;li&gt;Student's-t (&lt;code&gt;mixed_model(..., &lt;span class="hljs-string"&gt;family = students.t(df = 4)&lt;/span&gt;)&lt;/code&gt;)&lt;/li&gt;
    &lt;li&gt;Beta (&lt;code&gt;mixed_model(..., &lt;span class="hljs-string"&gt;family = beta.fam()&lt;/span&gt;)&lt;/code&gt;)&lt;/li&gt;
    &lt;li&gt;Gamma (&lt;code&gt;mixed_model(..., &lt;span class="hljs-string"&gt;family = Gamma()&lt;/span&gt;)&lt;/code&gt;)&lt;/li&gt;
    &lt;li&gt;censored Gaussian (&lt;code&gt;mixed_model(..., &lt;span class="hljs-string"&gt;family = censored.normal()&lt;/span&gt;)&lt;/code&gt;)&lt;/li&gt;
  &lt;/ul&gt;
  &lt;br&gt;
  &lt;ul&gt;
    &lt;li&gt;Binomial (&lt;code&gt;mixed_model(..., &lt;span class="hljs-string"&gt;family = binomial()&lt;/span&gt;)&lt;/code&gt;)&lt;/li&gt;
    &lt;li&gt;Poisson (&lt;code&gt;mixed_model(..., &lt;span class="hljs-string"&gt;family = poisson()&lt;/span&gt;)&lt;/code&gt;)&lt;/li&gt;
    &lt;li&gt;Negative Binomial (&lt;code&gt;mixed_model(..., &lt;span class="hljs-string"&gt;family = negative.binomial()&lt;/span&gt;)&lt;/code&gt;)&lt;/li&gt;
    &lt;li&gt;Beta Binomial (&lt;code&gt;mixed_model(..., &lt;span class="hljs-string"&gt;family = beta.binomial()&lt;/span&gt;)&lt;/code&gt;)&lt;/li&gt;
  &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;button class="modal-button" href="#Plots"&gt;&lt;strong&gt;Diagnostics&lt;/strong&gt;&lt;/button&gt;
&lt;div id="Plots" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
  &lt;ul&gt;
    &lt;li&gt;MCMC chains (&lt;code&gt;traceplot()&lt;/code&gt; or &lt;code&gt;ggtraceplot()&lt;/code&gt;)&lt;/li&gt;
    &lt;li&gt;Density (&lt;code&gt;traceplot()&lt;/code&gt; or &lt;code&gt;ggtraceplot()&lt;/code&gt;)&lt;/li&gt;
    &lt;li&gt;Gelman-Rubin (&lt;code&gt;gelman_diag()&lt;/code&gt;)&lt;/li&gt;
    &lt;li&gt;cumulative plot (&lt;code&gt;cumuplot()&lt;/code&gt;)&lt;/li&gt;
  &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;

]

.three-cols[

&lt;button class="modal-button" href="#Penalties"&gt;&lt;strong&gt;Shrinkage Priors&lt;/strong&gt;&lt;/button&gt;
&lt;div id="Penalties" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
      Using the &lt;strong&gt;priors&lt;/strong&gt; argument we can specify penalties:
  &lt;pre&gt;&lt;code class="r hljs remark-code"&gt;
  &lt;div class="remark-code-line"&gt;jm(..., &lt;span class="hljs-number"&gt;priors = list("penalty_alphas" = "horseshoe")&lt;/span&gt;)&lt;/div&gt;
  &lt;div class="remark-code-line"&gt;&lt;/div&gt;
  &lt;div class="remark-code-line"&gt;jm(..., &lt;span class="hljs-number"&gt;priors = list("penalty_gammas" = "ridge")&lt;/span&gt;)&lt;/div&gt;
&lt;/code&gt;&lt;/pre&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;button class="modal-button" href="#Compare"&gt;&lt;strong&gt;Model Comparison&lt;/strong&gt;&lt;/button&gt;
&lt;div id="Compare" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
      Using the &lt;code&gt;compare_jm()&lt;/code&gt; function we can compare fitted joint models using DIC, WAIC and LPML
  &lt;pre&gt;&lt;code class="r hljs remark-code"&gt;
  &lt;div class="remark-code-line"&gt;&lt;span class="hljs-number"&gt;fit1&lt;/span&gt; &lt;- jm(&lt;span class="hljs-number"&gt;CoxModel1&lt;/span&gt;, &lt;span class="hljs-number"&gt;MixedModels1&lt;/span&gt;, ...)&lt;/div&gt;
  &lt;div class="remark-code-line"&gt;&lt;span class="hljs-string"&gt;fit2&lt;/span&gt; &lt;- jm(&lt;span class="hljs-string"&gt;CoxModel2&lt;/span&gt;, &lt;span class="hljs-string"&gt;MixedModels2&lt;/span&gt;, ...)&lt;/div&gt;
  &lt;div class="remark-code-line"&gt;&lt;/div&gt;
  &lt;div class="remark-code-line"&gt;compare_jm(&lt;span class="hljs-number"&gt;fit1&lt;/span&gt;, &lt;span class="hljs-string"&gt;fit2&lt;/span&gt;)&lt;/div&gt;
&lt;/code&gt;&lt;/pre&gt;
  &lt;/div&gt;
&lt;/div&gt;

]

.three-cols[
&lt;button class="modal-button" href="#DynPred"&gt;&lt;strong&gt;Dynamic Predictions&lt;/strong&gt;&lt;/button&gt;
&lt;div id="DynPred" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
  &lt;strong&gt;To-Do&lt;/strong&gt;
  &lt;ul&gt;
    &lt;li&gt;Longitudinal outcomes&lt;/li&gt;
    &lt;li&gt;Event outcomes (including competing risks)&lt;/li&gt;
    &lt;li&gt;Accuracy measures&lt;/li&gt;
  &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;


&lt;button class="modal-button" href="#RecEvents"&gt;&lt;strong&gt;Recurrent Events&lt;/strong&gt;&lt;/button&gt;
&lt;div id="RecEvents" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
  &lt;strong&gt;To-Do&lt;/strong&gt;
  &lt;ul&gt;
    &lt;li&gt;Longitudinal outcomes&lt;/li&gt;
    &lt;li&gt;Relative risk model with a frailty term for recurrent events&lt;/li&gt;
    &lt;li&gt;Relative risk model terminating event linked with frailty&lt;/li&gt;
  &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;

]

---
class: center, middle

.nord0box[
More about **JMbayes2** in the dedicated website&lt;br&gt;&lt;br&gt;
&lt;a href="https://drizopoulos.github.io/JMbayes2/"&gt;&lt;i class="fas fa-globe-americas"&gt;&lt;/i&gt; https://drizopoulos.github.io/JMbayes2/&lt;/a&gt;
]

---
class: the-end, center, middle
layout: true
count: false

## Thank you for your attention!


&lt;div id="contact"&gt;
&lt;a href="mailto:d.rizopoulos@erasmusmc.nl"&gt;&lt;i class="fas fa-envelope"&gt;&lt;/i&gt; d.rizopoulos@erasmusmc.nl&lt;/a&gt; &amp;emsp;
&lt;a href="https://twitter.com/drizopoulos"&gt;&lt;i class="fab fa-twitter"&gt;&lt;/i&gt; drizopoulos&lt;/a&gt; &amp;emsp;
&lt;a href="https://github.com/drizopoulos"&gt;&lt;i class="fab fa-github"&gt;&lt;/i&gt; drizopoulos&lt;/a&gt; &amp;emsp;
&lt;a href="http://www.drizopoulos.com/"&gt;&lt;i class="fas fa-globe-americas"&gt;&lt;/i&gt; http://www.drizopoulos.com/&lt;/a&gt;
&lt;/div&gt;

---
count: false

&lt;!-- &lt;script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'&gt;&lt;/script&gt; --&gt;
&lt;script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"&gt;
&lt;/script&gt;
 
 
&lt;script&gt;
// Get the button that opens the modal
var btn = document.querySelectorAll("button.modal-button");

// All page modals
var modals = document.querySelectorAll('.modal');

// Get the &lt;span&gt; element that closes the modal
var spans = document.getElementsByClassName("close");

// When the user clicks the button, open the modal
for (var i = 0; i &lt; btn.length; i++) {
 btn[i].onclick = function(e) {
    e.preventDefault();
    modal = document.querySelector(e.target.getAttribute("href"));
    modal.style.display = "block";
 }
}

// When the user clicks on &lt;span&gt; (x), close the modal
for (var i = 0; i &lt; spans.length; i++) {
 spans[i].onclick = function() {
    for (var index in modals) {
      if (typeof modals[index].style !== 'undefined') modals[index].style.display = "none";    
    }
 }
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
    if (event.target.classList.contains('modal')) {
     for (var index in modals) {
      if (typeof modals[index].style !== 'undefined') modals[index].style.display = "none";    
     }
    }
}
&lt;/script&gt;

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "nord",
"highlightLines": true,
"highlightSpans": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
