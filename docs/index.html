<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>JMbayes2</title>
    <meta charset="utf-8" />
    <meta name="author" content="Dimitris Rizopoulos" />
    <meta name="date" content="2023-08-18" />
    <script src="libs/header-attrs-2.23/header-attrs.js"></script>
    <link href="libs/tile-view-0.2.6/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view-0.2.6/tile-view.js"></script>
    <script src="libs/xaringanExtra_fit-screen-0.2.6/fit-screen.js"></script>
    <link rel="stylesheet" href="style.css" type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">

class: title-slide-custom
count: false



&lt;!-- &lt;h1&gt;JMbayes2&lt;/h1&gt; --&gt;
&lt;div style="font-size: 50pt; font-weight: 900; color: var(--nord4); margin-top: 60px;"&gt;
JMbayes2
&lt;/div&gt;

&lt;div style="font-size: 26pt; color: var(--nord9); font-weight: 300; margin-top:40px;"&gt;
Extended Joint Models under the Bayesian Approach
&lt;/div&gt;

&lt;div id = "author"&gt;
&lt;div style = "font-size: 30pt; font-weight: bolder; color: var(--nord4);"&gt;Dimitris Rizopoulos, P. Afonso, G. Papageorgiou&lt;/div&gt;
&lt;div style = "color: var(--nord9);"&gt;Department of Biostatistics&lt;/div&gt;
&lt;/div&gt;

&lt;div id="contact"&gt;
&lt;a href="mailto:d.rizopoulos@erasmusmc.nl"&gt;&lt;i class="fas fa-envelope"&gt;&lt;/i&gt; d.rizopoulos@erasmusmc.nl&lt;/a&gt; &amp;emsp;
&lt;a href="https://twitter.com/drizopoulos"&gt;&lt;i class="fab fa-twitter"&gt;&lt;/i&gt; drizopoulos&lt;/a&gt; &amp;emsp;
&lt;a href="https://github.com/drizopoulos"&gt;&lt;i class="fab fa-github"&gt;&lt;/i&gt; drizopoulos&lt;/a&gt; &amp;emsp;
&lt;/div&gt;

---
layout: true

&lt;link href="https://unpkg.com/nord-highlightjs@0.1.0/dist/nord.css" rel="stylesheet" type="text/css" /&gt;
&lt;link href="fontawesome-free-5.14.0-web/css/all.css" rel="stylesheet"&gt;

&lt;div class="my-footer"&gt;&lt;span&gt;
&lt;a href="https://twitter.com/drizopoulos"&gt;&lt;i class="fab fa-twitter"&gt;&lt;/i&gt; drizopoulos&lt;/a&gt;
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
&lt;a href="https://github.com/drizopoulos"&gt;&lt;i class="fab fa-github"&gt;&lt;/i&gt; drizopoulos&lt;/a&gt; &amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
&lt;a href = "http://www.drizopoulos.com/"&gt;&lt;i class="fas fa-globe-americas"&gt;&lt;/i&gt; www.drizopoulos.com&lt;/a&gt;
&lt;/span&gt;&lt;/div&gt; 

---
class: center, middle, animated, fadeIn

# Joint Models:&lt;br&gt;Current Standard

---

## A Bit of History

&lt;p&gt; &lt;/p&gt;

--

&lt;div style = "width: 75%; padding: 1.15em 2em; background-color: var(--nord0); margin: auto; display: block;"&gt;
&lt;strong&gt;Joint models have been around for many years...&lt;/strong&gt;
&lt;/div&gt;

--

&lt;br&gt;

- Two parallel trajectories

.pull-left[
**Event Process**
&lt;div style = "width: 75%; padding: 1.15em 2em; background-color: var(--nord0); margin: auto; display: block;"&gt;
endogenous time-varying covariates
&lt;/div&gt;
]

.pull-right[
**Longitudinal Outcomes**
&lt;div style = "width: 75%; padding: 1.15em 2em; background-color: var(--nord0); margin: auto; display: block;"&gt;
non-random (MNAR) dropout
&lt;/div&gt;
]


---

## JMs and Extensions

&lt;div style = "width: 75%; padding: 1.15em 2em; background-color: var(--nord0); margin: auto; display: block;"&gt;
&lt;strong&gt;Basic assumption: &lt;font color = "red"&gt;Conditional Independence&lt;/font&gt;&lt;/strong&gt; &lt;br&gt; The random effects \(\color{var(--nord15)}{b}\) explain all interrelationships.
&lt;/div&gt;

.footnote[
[&lt;i class = "fas fa-book"&gt;&lt;/i&gt; Rizopoulos (2012)](https://www.crcpress.com/product/isbn/9781439872864)
]

--

&lt;br&gt;
* `\(\mathcal{Y}\)`: Longitudinal process
* `\(\mathcal{T}\)`: Event process

--

`\begin{align*}
p\{\mathcal{Y},\, \mathcal{T} \mid \color{var(--nord15)}{b}\} = 
p\{\mathcal{Y} \mid \color{var(--nord15)}{b}\} \; 
p\{\mathcal{T} \mid \color{var(--nord15)}{b}\}
\end{align*}`

---

## JMs and Extensions



&lt;img src="JM.gif" alt="DynPreds" style="margin:0px 0px 0px 0px; width:450px;"&gt; 

---

## JMs and Extensions

&lt;br&gt;

.pull-left[
**Longitudinal Process**
- multiple outcomes
- continuous, discrete, left-censored
- flexible models (splines, etc.)
]

.pull-right[
**Event Process**
- competing risks
- multi-state processes
- recurrent events
- multivariate
]

---

## JMs and Extensions

**Conditional Independence:** .reference[[&lt;i class = "fas fa-book"&gt;&lt;/i&gt; Rizopoulos (2012)](https://www.crcpress.com/product/isbn/9781439872864)]

&lt;ul class="fa-ul"&gt;
  &lt;li&gt;&lt;span class="fa-li" style = "color:var(--nord14);"&gt;
      &lt;i class="far fa-smile"&gt;&lt;/i&gt;&lt;/span&gt;
      mathematically convenient&lt;/li&gt;
  &lt;li&gt;&lt;span class="fa-li" style = "color:var(--nord11);"&gt;
  &lt;i class="far fa-frown"&gt;&lt;/i&gt;&lt;/span&gt;
  computionally intensive&lt;/li&gt;
&lt;/ul&gt;

--

.pull-left[
**Maximum Likelihood:**
&lt;div style = "width: 75%; padding: 1.15em 2em; background-color: var(--nord0); margin: auto; display: block;"&gt;
requires high-dimensional numerical integration
&lt;/div&gt;
]

.pull-right[
**Bayesian:**
&lt;div style = "width: 75%; padding: 1.15em 2em; background-color: var(--nord0); margin: auto; display: block;"&gt;
requires sampling high-dimensional random effects
&lt;/div&gt;
]

---

## Theory vs Practice

As with many other statistical techniques,&lt;br&gt; 
&amp;nbsp;&amp;nbsp;&amp;nbsp;it took some years for JMs software to appear

--

&lt;br&gt;

&lt;div style = "width: 75%; padding: 1.15em 2em; background-color: var(--nord0); margin: auto; display: block;"&gt;
&lt;strong&gt;Nowadays, given the rise of the  &lt;font color = "red"&gt;R ecosystem&lt;/font&gt; a number of packages is available&lt;/strong&gt;
&lt;/div&gt;


---

## Available Software

.pull-left[
**Maximum Likelihood:**

&lt;button class="modal-button" href="#JM"&gt;&lt;strong&gt;JM&lt;/strong&gt;&lt;/button&gt;
&lt;div id="JM" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
  &lt;ul&gt;
    &lt;li&gt; One continuous longitudinal outcome&lt;/li&gt;
    &lt;li&gt; Competing risks&lt;/li&gt;
    &lt;li&gt; (pseudo) adaptive Gaussian quadrature&lt;/li&gt;
  &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;button class="modal-button" href="#joineRML"&gt;&lt;strong&gt;joineRML&lt;/strong&gt;&lt;/button&gt;
&lt;div id="joineRML" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
  &lt;ul&gt;
    &lt;li&gt; Multiple continuous longitudinal outcomes&lt;/li&gt;
    &lt;li&gt; Monte Carlo EM (&lt;font color="red"&gt;needs tuning&lt;/font&gt;)&lt;/li&gt;
  &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;button class="modal-button" href="#frailtyPack"&gt;&lt;strong&gt;frailtyPack&lt;/strong&gt;&lt;/button&gt;
&lt;div id="frailtyPack" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
  &lt;ul&gt;
    &lt;li&gt; One continuous longitudinal outcome&lt;/li&gt;
    &lt;li&gt; recurrent events &amp; terminating event&lt;/li&gt;
  &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;
]

.pull-right[
**Bayesian:**
&lt;button class="modal-button" href="#JMbayes"&gt;&lt;strong&gt;JMbayes&lt;/strong&gt;&lt;/button&gt;
&lt;div id="JMbayes" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
  &lt;ul&gt;
    &lt;li&gt; Multiple longitudinal outcomes of different type&lt;/li&gt;
    &lt;li&gt; competing risks &amp; multi-state models&lt;/li&gt;
    &lt;li&gt; Corrected two-stage approach (&lt;font color="red"&gt;not fully Bayesian&lt;/font&gt;)&lt;/li&gt;
  &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;button class="modal-button" href="#INLAjoint"&gt;&lt;strong&gt;INLAjoint&lt;/strong&gt;&lt;/button&gt;
&lt;div id="INLAjoint" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
  &lt;ul&gt;
    &lt;li&gt; Multiple longitudinal outcomes of different type&lt;/li&gt;
    &lt;li&gt; competing risks &amp; multi-state models&lt;/li&gt;
    &lt;li&gt; &lt;font color="red"&gt;no control approximation error&lt;/font&gt;&lt;/li&gt;
    &lt;li&gt; &lt;font color="red"&gt;limited model assessment diagnostics&lt;/font&gt;&lt;/li&gt;
  &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;button class="modal-button" href="#stan_jm"&gt;&lt;strong&gt;stan_jm&lt;/strong&gt;&lt;/button&gt;
&lt;div id="stan_jm" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
  &lt;ul&gt;
    &lt;li&gt; Multiple longitudinal outcomes of different type&lt;/li&gt;
    &lt;li&gt; fully Bayesian in STAN (&lt;font color="red"&gt;slow&lt;/font&gt;)&lt;/li&gt;
  &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;button class="modal-button" href="#bamlss"&gt;&lt;strong&gt;jm_bamlss&lt;/strong&gt;&lt;/button&gt;
&lt;div id="bamlss" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
  &lt;ul&gt;
    &lt;li&gt; single longitudinal outcomes&lt;/li&gt;
    &lt;li&gt; no competing risks nor multi-state models&lt;/li&gt;
  &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;
]

---

## Available Software

&lt;br&gt;&lt;br&gt;

&lt;div style = "width: 75%; padding: 1.15em 2em; background-color: var(--nord0); margin: auto; display: block;"&gt;
&lt;strong&gt;Still no software package exists to satisfy all needs&lt;/strong&gt;
&lt;/div&gt;

---
class: center, middle, animated, fadeIn

# JMbayes2

---

## A New Package

.nord0box[
**&lt;span style="font-size: 1.5rem;"&gt;&amp;#8680;&lt;/span&gt; 
Learning from the lessons of the past we decided to create a new package**
]

--

&lt;br&gt;

Our aims

.pull-left[
* versatile
* user-friendly
* fast
* complete
]

.pull-right[
&lt;div style = "color: var(--nord3);"&gt;
&lt;ul&gt;
&lt;li&gt;cover (almost) all extensions&lt;/li&gt;
&lt;li&gt;straightforward syntax&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;C++&lt;/strong&gt; &amp; computational tricks&lt;/li&gt;
&lt;li&gt;support functions&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
]

---

## Under the Hood

.nord0box[
**Work horse: Metropolis-Hastings algorithm** &lt;br&gt;
&amp;nbsp;&amp;nbsp;&lt;span style="font-size: 1.5rem;"&gt;&amp;#8680;&lt;/span&gt; adaptive optimal scaling using the Robbinsâ€“Monro process
]

--

&lt;br&gt;

.nord0box[
**Computational aspects** &lt;br&gt;
&amp;nbsp;&amp;nbsp;&lt;span style="font-size: 1.5rem;"&gt;&amp;#8680;&lt;/span&gt; parallel sampling of random effects&lt;br&gt;
&amp;nbsp;&amp;nbsp;&lt;span style="font-size: 1.5rem;"&gt;&amp;#8680;&lt;/span&gt; info from separate fits&lt;br&gt;
]

---

## Under the Hood

&lt;br&gt;

.nord0box[
**Implementation** &lt;br&gt;
&amp;nbsp;&amp;nbsp;&lt;span style="font-size: 1.5rem;"&gt;&amp;#8680;&lt;/span&gt; MCMC written in C++&lt;br&gt;
&amp;nbsp;&amp;nbsp;&lt;span style="font-size: 1.5rem;"&gt;&amp;#8680;&lt;/span&gt; avoiding double computations&lt;br&gt;
]



---

## An Example


```r
library("JMbayes2")
fm1 &lt;- lme(log(serBilir) ~ year * sex, data = pbc2, random = ~ year | id)
CoxFit &lt;- coxph(Surv(years, status2) ~ sex, data = pbc2.id)

jointFit1 &lt;- jm(CoxFit, fm1, time_var = "year")
```

--

&lt;br&gt;

**Check convergence**


```r
ggtraceplot(jointFit1, "alphas")
```


---

## Traceplot

&lt;img src="index_files/figure-html/unnamed-chunk-4-1.png" width="100%" /&gt;

---

## Model Summary

.scroll450[

```r
summary(jointFit1)
```

```
## 
## Call:
## jm(Surv_object = CoxFit, Mixed_objects = fm1, time_var = "year")
## 
## Data Descriptives:
## Number of Groups: 312		Number of events: 140 (44.9%)
## Number of Observations:
##   log(serBilir): 1945
## 
##                  DIC     WAIC      LPML
## marginal    4255.243 5193.189 -2927.695
## conditional 3438.104 3256.032 -1840.069
## 
## Random-effects covariance matrix:
##                     
##        StdDev   Corr
## (Intr) 1.0053 (Intr)
## year   0.1810 0.3976
## 
## Survival Outcome:
##                         Mean  StDev    2.5%  97.5%      P   Rhat
## sexfemale            -0.2626 0.2867 -0.7847 0.3157 0.3689 1.0020
## value(log(serBilir))  1.2475 0.0947  1.0613 1.4390 0.0000 1.0057
## 
## Longitudinal Outcome: log(serBilir) (family = gaussian, link = identity)
##                   Mean  StDev    2.5%   97.5%      P   Rhat
## (Intercept)     0.7223 0.1720  0.3826  1.0622 0.0000 1.0000
## year            0.2638 0.0376  0.1912  0.3395 0.0000 1.0055
## sexfemale      -0.2586 0.1824 -0.6156  0.0971 0.1620 1.0000
## year:sexfemale -0.0899 0.0402 -0.1705 -0.0120 0.0229 1.0047
## sigma           0.3469 0.0068  0.3337  0.3607 0.0000 1.0207
## 
## MCMC summary:
## chains: 3 
## iterations per chain: 3500 
## burn-in per chain: 500 
## thinning: 1 
## time: 18 sec
```
]

---

## Multivariate

&lt;br&gt;


```r
fm2 &lt;- lme(prothrombin ~ year * sex, data = pbc2, random = ~ year | id)
fm3 &lt;- mixed_model(ascites ~ year + sex, data = pbc2,
                   random = ~ year | id, family = binomial())

jointFit2 &lt;- jm(CoxFit, list(fm1, fm2, fm3), time_var = "year",
                n_iter = 12000L, n_burnin = 2000L, n_thin = 5L)
```

---

## Multivariate

.scroll450[

```r
summary(jointFit2)
```

```
## 
## Call:
## jm(Surv_object = CoxFit, Mixed_objects = list(fm1, fm2, fm3), 
##     time_var = "year", n_iter = 12000L, n_burnin = 2000L, n_thin = 5L)
## 
## Data Descriptives:
## Number of Groups: 312		Number of events: 140 (44.9%)
## Number of Observations:
##   log(serBilir): 1945
##   prothrombin: 1945
##   ascites: 1885
## 
##                  DIC      WAIC       LPML
## marginal    11501.71 592782.35 -39636.864
## conditional 12491.57  12237.35  -6618.324
## 
## Random-effects covariance matrix:
##                                                  
##        StdDev   Corr                             
## (Intr) 0.9913 (Intr)   year (Intr)   year (Intr) 
## year   0.1899 0.4258                             
## (Intr) 0.7774 0.5618 0.4965                      
## year   0.3310 0.4145 0.3559 0.0587               
## (Intr) 2.9639 0.5629 0.5285 0.6224 0.2768        
## year   0.4601 0.3954 0.6588 0.2551 0.4505 -0.0095
## 
## Survival Outcome:
##                         Mean  StDev    2.5%   97.5%      P   Rhat
## sexfemale            -0.8052 0.3825 -1.5633 -0.0734 0.0347 1.0019
## value(log(serBilir))  0.4671 0.1765  0.1134  0.7965 0.0117 1.0737
## value(prothrombin)    0.0463 0.1518 -0.2836  0.3178 0.6847 1.0408
## value(ascites)        0.6305 0.1388  0.3947  0.9281 0.0000 1.0245
## 
## Longitudinal Outcome: log(serBilir) (family = gaussian, link = identity)
##                   Mean  StDev    2.5%   97.5%      P   Rhat
## (Intercept)     0.7014 0.1681  0.3689  1.0278 0.0003 1.0008
## year            0.2689 0.0340  0.2017  0.3365 0.0000 1.0000
## sexfemale      -0.2395 0.1784 -0.5871  0.1087 0.1840 1.0006
## year:sexfemale -0.0794 0.0360 -0.1508 -0.0082 0.0280 1.0031
## sigma           0.3466 0.0066  0.3340  0.3597 0.0000 1.0011
## 
## Longitudinal Outcome: prothrombin (family = gaussian, link = identity)
##                   Mean  StDev    2.5%   97.5%      P   Rhat
## (Intercept)    10.9424 0.1693 10.6140 11.2733 0.0000 1.0018
## year            0.2436 0.0741  0.0980  0.3915 0.0003 1.0002
## sexfemale      -0.4000 0.1810 -0.7613 -0.0475 0.0240 1.0016
## year:sexfemale  0.0549 0.0781 -0.0992  0.2103 0.4783 1.0013
## sigma           1.0551 0.0200  1.0164  1.0952 0.0000 1.0085
## 
## Longitudinal Outcome: ascites (family = binomial, link = logit)
##                Mean  StDev    2.5%   97.5%      P   Rhat
## (Intercept) -4.5003 0.7081 -5.9580 -3.1942 0.0000 1.0087
## year         0.6081 0.0732  0.4700  0.7582 0.0000 1.0402
## sexfemale   -0.5043 0.6911 -1.8435  0.8308 0.4613 1.0045
## 
## MCMC summary:
## chains: 3 
## iterations per chain: 12000 
## burn-in per chain: 2000 
## thinning: 5 
## time: 2.1 min
```
]

---

## Functional Forms


```r
jointFit3 &lt;- update(jointFit2, 
  functional_forms = ~ slope(log(serBilir)) + slope(log(serBilir)):sex + 
    area(prothrombin))
```

--

.pull-left[
**Slope**
`$$h_i(t) = h_0(t) \exp\biggl\{\alpha \bbox[#2E3440, 5pt]{\frac{d\color{var(--nord14)}{\eta_i(t)}}{dt}}\biggr\}$$`
]

.pull-right[
**(normalized) Area**
`$$h_i(t) = h_0(t) \exp\biggl\{\alpha \bbox[#2E3440, 5pt]{\frac{1}{t} \int_0^t \color{var(--nord14)}{\eta_i(s)}\; ds}\biggr\}$$`
]

&lt;div align="center" style="padding-top:30px;"&gt;\(\color{var(--nord3)}{\eta_i(t) = \mathbf x_i(t)^\top \boldsymbol \beta + \mathbf z_i(t)^\top \mathbf b_i}\)&lt;/div&gt;

---

## Functional Forms

.scroll450[

```r
summary(jointFit3)
```

```
## 
## Call:
## jm(Surv_object = CoxFit, Mixed_objects = list(fm1, fm2, fm3), 
##     time_var = "year", functional_forms = ~slope(log(serBilir)) + 
##         slope(log(serBilir)):sex + area(prothrombin), n_iter = 12000L, ...
## 
## Data Descriptives:
## Number of Groups: 312		Number of events: 140 (44.9%)
## Number of Observations:
##   log(serBilir): 1945
##   prothrombin: 1945
##   ascites: 1885
## 
##                  DIC     WAIC      LPML
## marginal    11407.35 12593.53 -6801.446
## conditional 12464.61 12210.27 -6597.434
## 
## Random-effects covariance matrix:
##                                                 
##        StdDev   Corr                            
## (Intr) 0.9839 (Intr)   year (Intr)   year (Intr)
## year   0.1920 0.4627                            
## (Intr) 0.7730 0.5623 0.5129                     
## year   0.3329 0.4331 0.3694 0.0773              
## (Intr) 2.9335 0.5821 0.5332 0.6110 0.2939       
## year   0.4724 0.4700 0.6992 0.3232 0.4553 0.0607
## 
## Survival Outcome:
##                                   Mean  StDev    2.5%  97.5%      P   Rhat
## sexfemale                      -0.2101 0.7811 -1.7096 1.3984 0.7723 1.0581
## slope(log(serBilir))            4.1106 2.0171 -0.0720 7.8839 0.0543 1.0085
## slope(log(serBilir)):sexfemale -2.2855 2.2898 -7.1533 2.0401 0.3127 1.0604
## area(prothrombin)               0.1355 0.2434 -0.3670 0.5848 0.5390 1.1560
## value(ascites)                  0.7797 0.1901  0.4654 1.1858 0.0000 1.2316
## 
## Longitudinal Outcome: log(serBilir) (family = gaussian, link = identity)
##                   Mean  StDev    2.5%   97.5%      P   Rhat
## (Intercept)     0.6770 0.1658  0.3506  0.9979 0.0003 1.0005
## year            0.2642 0.0338  0.1977  0.3311 0.0000 1.0004
## sexfemale      -0.2145 0.1763 -0.5628  0.1313 0.2197 1.0005
## year:sexfemale -0.0688 0.0351 -0.1364 -0.0001 0.0500 1.0010
## sigma           0.3474 0.0065  0.3350  0.3600 0.0000 1.0001
## 
## Longitudinal Outcome: prothrombin (family = gaussian, link = identity)
##                   Mean  StDev    2.5%   97.5%      P   Rhat
## (Intercept)    10.9271 0.1716 10.5903 11.2658 0.0000 1.0016
## year            0.2387 0.0744  0.0969  0.3896 0.0017 1.0025
## sexfemale      -0.3811 0.1812 -0.7357 -0.0270 0.0357 1.0014
## year:sexfemale  0.0639 0.0781 -0.0880  0.2200 0.4093 1.0027
## sigma           1.0551 0.0203  1.0157  1.0956 0.0000 1.0102
## 
## Longitudinal Outcome: ascites (family = binomial, link = logit)
##                Mean  StDev    2.5%   97.5%      P   Rhat
## (Intercept) -4.6078 0.7255 -6.1072 -3.2645 0.0000 1.0750
## year         0.6355 0.0768  0.5003  0.7970 0.0000 1.1650
## sexfemale   -0.3989 0.6978 -1.7520  0.9894 0.5607 1.0013
## 
## MCMC summary:
## chains: 3 
## iterations per chain: 12000 
## burn-in per chain: 2000 
## thinning: 5 
## time: 2.3 min
```
]

---

## Competing Risks

Bring the data in the competing risks long format


```r
pbc2.idCR &lt;- crisk_setup(pbc2.id, statusVar = "status", censLevel = "alive", 
                    nameStrata = "CR")

pbc2.idCR[pbc2.idCR$id %in% c(1, 2, 5), c("id", "years", "status", "status2", "CR")]
```

```
##     id     years       status status2           CR
## 1    1  1.095170         dead       1         dead
## 1.1  1  1.095170         dead       0 transplanted
## 2    2 14.152338        alive       0         dead
## 2.1  2 14.152338        alive       0 transplanted
## 5    5  4.120578 transplanted       0         dead
## 5.1  5  4.120578 transplanted       1 transplanted
```

---

## Competing Risks

&lt;br&gt;

Fit a competing risks Cox model


```r
CoxFit_CR &lt;- coxph(Surv(years, status2) ~ (age + drug) * strata(CR),
                     data = pbc2.idCR)
```

---

## Competing Risks

&lt;br&gt;

Fit the competing risks joint model


```r
jFit_CR &lt;- jm(CoxFit_CR, fm1, time_var = "year", 
              functional_forms = ~ value(log(serBilir)):CR, 
              n_iter = 25000L, n_burnin = 5000L, n_thin = 5L)
```

---

## Competing Risks

.scroll450[

```r
summary(jFit_CR)
```

```
## 
## Call:
## jm(Surv_object = CoxFit_CR, Mixed_objects = fm1, time_var = "year", 
##     functional_forms = ~value(log(serBilir)):CR, n_iter = 25000L, 
##     n_burnin = 5000L, n_thin = 5L)
## 
## Data Descriptives:
## Number of Groups: 312		Number of events: 169 (27.1%)
## Number of Observations:
##   log(serBilir): 1945
## 
##                  DIC     WAIC      LPML
## marginal    4435.774 5313.425 -3238.973
## conditional 3624.102 3446.399 -2000.840
## 
## Random-effects covariance matrix:
##                     
##        StdDev   Corr
## (Intr) 1.0020 (Intr)
## year   0.1817 0.3973
## 
## Survival Outcome:
##                                        Mean  StDev    2.5%   97.5%      P
## age                                 -0.0681 0.0252 -0.1160 -0.0191 0.0035
## drugD-penicil                       -0.2892 0.3936 -1.0726  0.4564 0.4737
## age:strata(CR)dead                   0.1300 0.0248  0.0808  0.1757 0.0000
## drugD-penicil:strata(CR)dead         0.2697 0.4208 -0.5363  1.1023 0.5288
## value(log(serBilir)):CRtransplanted  1.1675 0.2083  0.7802  1.5974 0.0000
## value(log(serBilir)):CRdead          1.3682 0.1079  1.1643  1.5861 0.0000
##                                       Rhat
## age                                 1.0588
## drugD-penicil                       1.0069
## age:strata(CR)dead                  1.0744
## drugD-penicil:strata(CR)dead        1.0077
## value(log(serBilir)):CRtransplanted 1.0152
## value(log(serBilir)):CRdead         1.0031
## 
## Longitudinal Outcome: log(serBilir) (family = gaussian, link = identity)
##                   Mean  StDev    2.5%   97.5%      P   Rhat
## (Intercept)     0.7182 0.1717  0.3821  1.0565 0.0000 0.9999
## year            0.2624 0.0372  0.1898  0.3356 0.0000 1.0000
## sexfemale      -0.2591 0.1835 -0.6227  0.0989 0.1607 0.9998
## year:sexfemale -0.0845 0.0395 -0.1628 -0.0079 0.0305 1.0000
## sigma           0.3472 0.0067  0.3344  0.3605 0.0000 0.9998
## 
## MCMC summary:
## chains: 3 
## iterations per chain: 25000 
## burn-in per chain: 5000 
## thinning: 5 
## time: 4.9 min
```
]

---

## More Features

.three-cols[

&lt;button class="modal-button" href="#GLMMs"&gt;&lt;strong&gt;Mixed Effects Models&lt;/strong&gt;&lt;/button&gt;
&lt;div id="GLMMs" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
  &lt;ul&gt;
  &lt;li&gt;Gaussian (&lt;code&gt;lme(...)&lt;/code&gt;)&lt;/li&gt;
    &lt;li&gt;Student's-t (&lt;code&gt;mixed_model(..., &lt;span class="hljs-string"&gt;family = students.t(df = 4)&lt;/span&gt;)&lt;/code&gt;)&lt;/li&gt;
    &lt;li&gt;Beta (&lt;code&gt;mixed_model(..., &lt;span class="hljs-string"&gt;family = beta.fam()&lt;/span&gt;)&lt;/code&gt;)&lt;/li&gt;
    &lt;li&gt;Gamma (&lt;code&gt;mixed_model(..., &lt;span class="hljs-string"&gt;family = Gamma()&lt;/span&gt;)&lt;/code&gt;)&lt;/li&gt;
    &lt;li&gt;censored Gaussian (&lt;code&gt;mixed_model(..., &lt;span class="hljs-string"&gt;family = censored.normal()&lt;/span&gt;)&lt;/code&gt;)&lt;/li&gt;
  &lt;/ul&gt;
  &lt;br&gt;
  &lt;ul&gt;
    &lt;li&gt;Binomial (&lt;code&gt;mixed_model(..., &lt;span class="hljs-string"&gt;family = binomial()&lt;/span&gt;)&lt;/code&gt;)&lt;/li&gt;
    &lt;li&gt;Poisson (&lt;code&gt;mixed_model(..., &lt;span class="hljs-string"&gt;family = poisson()&lt;/span&gt;)&lt;/code&gt;)&lt;/li&gt;
    &lt;li&gt;Negative Binomial (&lt;code&gt;mixed_model(..., &lt;span class="hljs-string"&gt;family = negative.binomial()&lt;/span&gt;)&lt;/code&gt;)&lt;/li&gt;
    &lt;li&gt;Beta Binomial (&lt;code&gt;mixed_model(..., &lt;span class="hljs-string"&gt;family = beta.binomial()&lt;/span&gt;)&lt;/code&gt;)&lt;/li&gt;
  &lt;/ul&gt;
  
  &lt;a href="https://drizopoulos.github.io/JMbayes2/articles/Non_Gaussian_Mixed_Models.html"&gt;&lt;i class="fas fa-globe-americas"&gt;&lt;/i&gt; vignette distributions&lt;/a&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;button class="modal-button" href="#Plots"&gt;&lt;strong&gt;Diagnostics&lt;/strong&gt;&lt;/button&gt;
&lt;div id="Plots" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
  &lt;ul&gt;
    &lt;li&gt;MCMC chains (&lt;code&gt;traceplot()&lt;/code&gt; or &lt;code&gt;ggtraceplot()&lt;/code&gt;)&lt;/li&gt;
    &lt;li&gt;Density (&lt;code&gt;traceplot()&lt;/code&gt; or &lt;code&gt;ggtraceplot()&lt;/code&gt;)&lt;/li&gt;
    &lt;li&gt;Gelman-Rubin (&lt;code&gt;gelman_diag()&lt;/code&gt;)&lt;/li&gt;
    &lt;li&gt;cumulative plot (&lt;code&gt;cumuplot()&lt;/code&gt;)&lt;/li&gt;
  &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;

]

.three-cols[

&lt;button class="modal-button" href="#Penalties"&gt;&lt;strong&gt;Shrinkage Priors&lt;/strong&gt;&lt;/button&gt;
&lt;div id="Penalties" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
      Using the &lt;strong&gt;priors&lt;/strong&gt; argument we can specify penalties:
  &lt;pre&gt;&lt;code class="r hljs remark-code"&gt;
  &lt;div class="remark-code-line"&gt;jm(..., &lt;span class="hljs-number"&gt;priors = list("penalty_alphas" = "horseshoe")&lt;/span&gt;)&lt;/div&gt;
  &lt;div class="remark-code-line"&gt;&lt;/div&gt;
  &lt;div class="remark-code-line"&gt;jm(..., &lt;span class="hljs-number"&gt;priors = list("penalty_gammas" = "ridge")&lt;/span&gt;)&lt;/div&gt;
&lt;/code&gt;&lt;/pre&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;button class="modal-button" href="#Compare"&gt;&lt;strong&gt;Model Comparison&lt;/strong&gt;&lt;/button&gt;
&lt;div id="Compare" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
      Using the &lt;code&gt;compare_jm()&lt;/code&gt; function we can compare fitted joint models using DIC, WAIC and LPML
  &lt;pre&gt;&lt;code class="r hljs remark-code"&gt;
  &lt;div class="remark-code-line"&gt;&lt;span class="hljs-number"&gt;fit1&lt;/span&gt; &lt;- jm(&lt;span class="hljs-number"&gt;CoxModel1&lt;/span&gt;, &lt;span class="hljs-number"&gt;MixedModels1&lt;/span&gt;, ...)&lt;/div&gt;
  &lt;div class="remark-code-line"&gt;&lt;span class="hljs-string"&gt;fit2&lt;/span&gt; &lt;- jm(&lt;span class="hljs-string"&gt;CoxModel2&lt;/span&gt;, &lt;span class="hljs-string"&gt;MixedModels2&lt;/span&gt;, ...)&lt;/div&gt;
  &lt;div class="remark-code-line"&gt;&lt;/div&gt;
  &lt;div class="remark-code-line"&gt;compare_jm(&lt;span class="hljs-number"&gt;fit1&lt;/span&gt;, &lt;span class="hljs-string"&gt;fit2&lt;/span&gt;)&lt;/div&gt;
&lt;/code&gt;&lt;/pre&gt;
  &lt;/div&gt;
&lt;/div&gt;

]

.three-cols[
&lt;button class="modal-button" href="#DynPred"&gt;&lt;strong&gt;Dynamic Predictions&lt;/strong&gt;&lt;/button&gt;
&lt;div id="DynPred" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
  Using the &lt;code&gt;predict()&lt;/code&gt; method we can calculate (dynamic) predictions
  &lt;ul&gt;
    &lt;li&gt;Longitudinal outcomes&lt;/li&gt;
    &lt;li&gt;Event outcomes (including competing risks)&lt;/li&gt;
    &lt;li&gt;Accuracy measures&lt;/li&gt;
      &lt;ul&gt;
        &lt;li&gt;discrimination: &lt;code&gt;tvROC()&lt;/code&gt;, &lt;code&gt;tvAUC()&lt;/code&gt;&lt;/li&gt;
        &lt;li&gt;calibration: &lt;code&gt;calibration_plot()&lt;/code&gt;, &lt;code&gt;calibration_metrics()&lt;/code&gt;&lt;/li&gt;
        &lt;li&gt;overall: &lt;code&gt;tvBrier()&lt;/code&gt;, &lt;code&gt;tvEPCE()&lt;/code&gt;&lt;/li&gt;
      &lt;/ul&gt;
  &lt;/ul&gt;
  
  &lt;a href="https://drizopoulos.github.io/JMbayes2/articles/Dynamic_Predictions.html"&gt;&lt;i class="fas fa-globe-americas"&gt;&lt;/i&gt; vignette predictions&lt;/a&gt;
  &lt;/div&gt;
&lt;/div&gt;


&lt;button class="modal-button" href="#MCEvents"&gt;&lt;strong&gt;Multi-State Processes&lt;/strong&gt;&lt;/button&gt;
&lt;div id="MCEvents" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
  &lt;strong&gt;Using &lt;code&gt;mc_setup()&lt;/code&gt; to setup the data and fitting a stratified Cox model&lt;/strong&gt;
  &lt;ul&gt;
    &lt;li&gt;Multiple longitudinal outcomes&lt;/li&gt;
    &lt;li&gt;Relative risk model per transition&lt;/li&gt;
  &lt;/ul&gt;
  
  &lt;a href="https://drizopoulos.github.io/JMbayes2/articles/Multi_State_Processes.html"&gt;&lt;i class="fas fa-globe-americas"&gt;&lt;/i&gt; vignette multi-state&lt;/a&gt;
  &lt;/div&gt;
&lt;/div&gt;


&lt;button class="modal-button" href="#RecEvents"&gt;&lt;strong&gt;Recurrent Events&lt;/strong&gt;&lt;/button&gt;
&lt;div id="RecEvents" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
  Using &lt;code&gt;rc_setup()&lt;/code&gt; to setup the data, fitting a stratified Cox model 
  and calling &lt;code&gt;jm(..., &lt;span class="hljs-string"&gt;recurrent = "..."&lt;/span&gt;)&lt;/code&gt;
  &lt;ul&gt;
    &lt;li&gt;Multiple longitudinal outcomes&lt;/li&gt;
    &lt;li&gt;Relative risk model with a frailty term for recurrent events&lt;/li&gt;
    &lt;li&gt;Relative risk models competing risks terminating events linked with frailty&lt;/li&gt;
    &lt;li&gt;Gap time and Calendar time formulations&lt;/li&gt;
  &lt;/ul&gt;
  
  &lt;a href="https://drizopoulos.github.io/JMbayes2/articles/Recurring_Events.html"&gt;&lt;i class="fas fa-globe-americas"&gt;&lt;/i&gt; vignette recurrent&lt;/a&gt;
  &lt;/div&gt;
&lt;/div&gt;

]

---
class: center, middle

.nord0box[
More about **JMbayes2** in the dedicated website&lt;br&gt;&lt;br&gt;
&lt;a href="https://drizopoulos.github.io/JMbayes2/"&gt;&lt;i class="fas fa-globe-americas"&gt;&lt;/i&gt; https://drizopoulos.github.io/JMbayes2/&lt;/a&gt;
]

---
class: the-end, center, middle
layout: true
count: false

## Thank you for your attention!


&lt;div id="contact"&gt;
&lt;a href="mailto:d.rizopoulos@erasmusmc.nl"&gt;&lt;i class="fas fa-envelope"&gt;&lt;/i&gt; d.rizopoulos@erasmusmc.nl&lt;/a&gt; &amp;emsp;
&lt;a href="https://twitter.com/drizopoulos"&gt;&lt;i class="fab fa-twitter"&gt;&lt;/i&gt; drizopoulos&lt;/a&gt; &amp;emsp;
&lt;a href="https://github.com/drizopoulos"&gt;&lt;i class="fab fa-github"&gt;&lt;/i&gt; drizopoulos&lt;/a&gt; &amp;emsp;
&lt;a href="http://www.drizopoulos.com/"&gt;&lt;i class="fas fa-globe-americas"&gt;&lt;/i&gt; http://www.drizopoulos.com/&lt;/a&gt;
&lt;/div&gt;

---
count: false

&lt;!-- &lt;script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'&gt;&lt;/script&gt; --&gt;
&lt;script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"&gt;
&lt;/script&gt;
 
 
&lt;script&gt;
// Get the button that opens the modal
var btn = document.querySelectorAll("button.modal-button");

// All page modals
var modals = document.querySelectorAll('.modal');

// Get the &lt;span&gt; element that closes the modal
var spans = document.getElementsByClassName("close");

// When the user clicks the button, open the modal
for (var i = 0; i &lt; btn.length; i++) {
 btn[i].onclick = function(e) {
    e.preventDefault();
    modal = document.querySelector(e.target.getAttribute("href"));
    modal.style.display = "block";
 }
}

// When the user clicks on &lt;span&gt; (x), close the modal
for (var i = 0; i &lt; spans.length; i++) {
 spans[i].onclick = function() {
    for (var index in modals) {
      if (typeof modals[index].style !== 'undefined') modals[index].style.display = "none";    
    }
 }
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
    if (event.target.classList.contains('modal')) {
     for (var index in modals) {
      if (typeof modals[index].style !== 'undefined') modals[index].style.display = "none";    
     }
    }
}
&lt;/script&gt;

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "nord",
"highlightLines": true,
"highlightSpans": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
